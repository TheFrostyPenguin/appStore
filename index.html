<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enterprise Application Manager</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #9ca3af;
      --primary: #38bdf8;
      --success: #22c55e;
      --warning: #eab308;
      --surface: #1f2937;
      --border: #2f3646;
      --radius: 12px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 10% 20%, rgba(56, 189, 248, 0.12), transparent 25%),
        radial-gradient(circle at 90% 10%, rgba(139, 92, 246, 0.12), transparent 20%),
        var(--bg);
      color: #e5e7eb;
      min-height: 100vh;
    }

    header {
      padding: 24px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      backdrop-filter: blur(16px);
      background: rgba(15, 23, 42, 0.75);
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .logo-badge {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, #38bdf8, #a78bfa);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: #0b1221;
    }

    main {
      padding: 24px 32px 48px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 24px;
    }

    @media (max-width: 1024px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: linear-gradient(180deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h2 {
      margin: 0 0 12px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h3 { margin: 12px 0 10px; }

    label { display: block; color: var(--muted); margin-bottom: 6px; font-size: 14px; }

    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: #f9fafb;
      font-size: 14px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.15);
    }

    textarea { resize: vertical; min-height: 80px; }

    .button {
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .button.primary {
      background: linear-gradient(135deg, #38bdf8, #22d3ee);
      color: #0b1221;
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.3);
    }

    .button.ghost { background: transparent; color: #e5e7eb; border: 1px solid var(--border); }

    .button:hover { transform: translateY(-1px); }

    .button:active { transform: translateY(0); }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.12);
      border: 1px solid rgba(56, 189, 248, 0.25);
      color: #e0f2fe;
      font-weight: 600;
      font-size: 12px;
    }

    .grid { display: grid; gap: 12px; }

    .app-card {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 16px;
      padding: 18px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(135deg, rgba(31, 41, 55, 0.85), rgba(17, 24, 39, 0.9));
    }

    .card-meta { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; color: var(--muted); font-size: 13px; }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .stat {
      padding: 12px;
      border-radius: 10px;
      background: var(--surface);
      border: 1px solid var(--border);
    }

    .stat strong { display: block; font-size: 18px; }
    .stat span { color: var(--muted); font-size: 13px; }

    .tag-row { display: flex; gap: 8px; flex-wrap: wrap; margin: 8px 0; }
    .usage-tag {
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px dashed rgba(236, 72, 153, 0.4);
      color: #fbcfe8;
      background: rgba(236, 72, 153, 0.08);
      font-size: 12px;
    }

    .alert { padding: 10px 12px; border-radius: 10px; font-size: 14px; }
    .alert.info { background: rgba(56, 189, 248, 0.08); border: 1px solid rgba(56, 189, 248, 0.2); }
    .alert.warn { background: rgba(234, 179, 8, 0.08); border: 1px solid rgba(234, 179, 8, 0.2); color: #fef9c3; }

    .divider { border-top: 1px solid var(--border); margin: 16px 0; }

    .chart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }

    .badge { background: rgba(34, 197, 94, 0.12); color: #bbf7d0; padding: 4px 8px; border-radius: 6px; font-weight: 600; font-size: 12px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script type="text/babel">
    const { useMemo, useState, useEffect, useRef } = React;

    const seedApps = [
      {
        id: 1,
        name: 'Telemetry Uploader',
        category: 'Monitoring',
        description: 'Secure agent used to upload device telemetry from field units to the central analytics store.',
        usageFields: ['IoT', 'Field Ops'],
        features: ['TLS 1.3 uploads', 'Offline queue with retry', 'Configurable data retention'],
        downloadUrl: '#',
        downloadCount: 189,
        ratings: [5, 5, 4, 4, 5, 3],
        lastUpdated: '2024-03-12',
        version: '3.2.1',
        suggestions: [
          { role: 'viewer', message: 'Expose retry metrics via metrics endpoint.' },
          { role: 'admin', message: 'Scheduled S3 vault rotation in May release.' },
        ],
      },
      {
        id: 2,
        name: 'Secure Docs',
        category: 'Productivity',
        description: 'Encrypted internal documentation hub with granular RBAC support and watermarking.',
        usageFields: ['PMO', 'Compliance'],
        features: ['Classified project isolation', 'Version history', 'Watermarked PDFs'],
        downloadUrl: '#',
        downloadCount: 243,
        ratings: [4, 4, 4, 5, 3],
        lastUpdated: '2024-05-08',
        version: '2.4.0',
        suggestions: [
          { role: 'viewer', message: 'Add dark mode toggle for readability.' },
        ],
      },
      {
        id: 3,
        name: 'Release Portal',
        category: 'DevOps',
        description: 'One-click deployment portal for staging and production with signed artifact verification.',
        usageFields: ['Engineering', 'SRE'],
        features: ['Immutable build log', 'JWT-based sign-offs', 'Canary automation'],
        downloadUrl: '#',
        downloadCount: 122,
        ratings: [5, 5, 5, 4],
        lastUpdated: '2024-04-01',
        version: '1.8.6',
        suggestions: [
          { role: 'viewer', message: 'Surface feature flags per environment.' },
        ],
      },
    ];

    const personaOptions = [
      { value: 'viewer', label: 'Viewer' },
      { value: 'admin', label: 'Admin' },
    ];

    const average = (values = []) => values.length ? values.reduce((a, b) => a + b, 0) / values.length : 0;

    const App = () => {
      const [persona, setPersona] = useState('viewer');
      const [apps, setApps] = useState(seedApps);
      const [filters, setFilters] = useState({ search: '', category: 'all' });
      const [newApp, setNewApp] = useState({ name: '', category: 'Monitoring', description: '', usageFields: '', features: '', downloadUrl: '' });
      const [rating, setRating] = useState(5);
      const [comment, setComment] = useState('');
      const [selectedAppId, setSelectedAppId] = useState(seedApps[0].id);

      const feedback = {
        rating,
        comment,
        setRating,
        setComment,
        reset: () => {
          setRating(5);
          setComment('');
        },
      };

      const categories = useMemo(() => ['all', ...new Set(apps.map((a) => a.category))], [apps]);

      const filteredApps = useMemo(() => {
        const searchLower = filters.search.toLowerCase();
        return apps.filter((app) => {
          const matchesSearch =
            app.name.toLowerCase().includes(searchLower) ||
            app.description.toLowerCase().includes(searchLower) ||
            app.usageFields.some((f) => f.toLowerCase().includes(searchLower));
          const matchesCategory = filters.category === 'all' || app.category === filters.category;
          return matchesSearch && matchesCategory;
        });
      }, [apps, filters]);

      const selectedApp = apps.find((a) => a.id === selectedAppId) || apps[0];

      const handleAddApp = (e) => {
        e.preventDefault();
        if (!newApp.name.trim() || !newApp.description.trim()) return;
        const id = Date.now();
        const app = {
          id,
          name: newApp.name.trim(),
          category: newApp.category,
          description: newApp.description.trim(),
          usageFields: newApp.usageFields.split(',').map((s) => s.trim()).filter(Boolean),
          features: newApp.features.split(',').map((s) => s.trim()).filter(Boolean),
          downloadUrl: newApp.downloadUrl || '#',
          downloadCount: 0,
          ratings: [],
          lastUpdated: new Date().toISOString().slice(0, 10),
          version: '1.0.0',
          suggestions: [],
        };
        setApps((prev) => [app, ...prev]);
        setNewApp({ name: '', category: 'Monitoring', description: '', usageFields: '', features: '', downloadUrl: '' });
        setSelectedAppId(id);
      };

      const handleFeedback = (e, appId) => {
        e.preventDefault();
        setApps((prev) =>
          prev.map((app) =>
            app.id === appId
              ? {
                  ...app,
                  ratings: [...app.ratings, Number(rating)],
                  suggestions: comment.trim()
                    ? [...app.suggestions, { role: persona, message: comment.trim() }]
                    : app.suggestions,
                }
              : app
          )
        );
        feedback.reset();
      };

      const handleDownload = (appId) => {
        setApps((prev) => prev.map((app) => (app.id === appId ? { ...app, downloadCount: app.downloadCount + 1 } : app)));
      };

      const stats = useMemo(() => {
        const totalDownloads = apps.reduce((sum, app) => sum + app.downloadCount, 0);
        const avgRating = average(apps.flatMap((a) => a.ratings));
        const categoryCounts = apps.reduce((map, app) => {
          map[app.category] = (map[app.category] || 0) + 1;
          return map;
        }, {});
        return { totalDownloads, avgRating, categoryCounts };
      }, [apps]);

      return (
        <>
          <header>
            <div className="logo">
              <div className="logo-badge">EA</div>
              <div>
                Enterprise Application Manager
                <div style={{ color: 'var(--muted)', fontWeight: 500, fontSize: 13 }}>Secure discovery • Feedback-driven upgrades</div>
              </div>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
              <span className="pill" style={{ background: persona === 'admin' ? 'rgba(34, 197, 94, 0.12)' : 'rgba(56, 189, 248, 0.12)', color: persona === 'admin' ? '#bbf7d0' : '#e0f2fe' }}>
                {persona.charAt(0).toUpperCase() + persona.slice(1)} persona
              </span>
            </div>
          </header>

          <main>
            <Controls
              persona={persona}
              setPersona={setPersona}
              filters={filters}
              setFilters={setFilters}
              categories={categories}
              newApp={newApp}
              setNewApp={setNewApp}
              onAddApp={handleAddApp}
              stats={stats}
            />
            <Catalog
              persona={persona}
              apps={filteredApps}
              allApps={apps}
              selectedAppId={selectedAppId}
              onSelectApp={setSelectedAppId}
              onDownload={handleDownload}
              onFeedback={handleFeedback}
              feedback={feedback}
            />
          </main>
        </>
      );
    };

    const Controls = ({ persona, setPersona, filters, setFilters, categories, newApp, setNewApp, onAddApp, stats }) => {
      const handleChange = (field) => (e) => setNewApp((prev) => ({ ...prev, [field]: e.target.value }));

      return (
        <div className="grid" style={{ gap: 16 }}>
          <div className="panel" style={{ padding: 0 }}>
            <div style={{ padding: '16px 18px', borderBottom: '1px solid var(--border)' }}>
              <h2>Controls</h2>
            </div>
            <div style={{ padding: '14px 18px' }}>
              <div className="grid" style={{ gridTemplateColumns: '1fr 1fr', gap: 12 }}>
                <div>
                  <label>Persona</label>
                  <select value={persona} onChange={(e) => setPersona(e.target.value)}>
                    {personaOptions.map((option) => (
                      <option key={option.value} value={option.value}>
                        {option.label}
                      </option>
                    ))}
                  </select>
                </div>
                <div>
                  <label>Category filter</label>
                  <select value={filters.category} onChange={(e) => setFilters((prev) => ({ ...prev, category: e.target.value }))}>
                    {categories.map((c) => (
                      <option key={c} value={c}>
                        {c === 'all' ? 'All categories' : c}
                      </option>
                    ))}
                  </select>
                </div>
              </div>
              <label style={{ marginTop: 12 }}>Search</label>
              <input
                placeholder="Search by name, description, or usage field"
                value={filters.search}
                onChange={(e) => setFilters((prev) => ({ ...prev, search: e.target.value }))}
              />
            </div>
            <div className="divider" />
            <div style={{ padding: '14px 18px' }}>
              <h3 style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 0 }}>
                Stats
                <span className="badge">Real-time</span>
              </h3>
              <div className="stats">
                <div className="stat">
                  <strong>{stats.totalDownloads}</strong>
                  <span>Total downloads</span>
                </div>
                <div className="stat">
                  <strong>{average(Object.values(stats.categoryCounts)).toFixed(1)}</strong>
                  <span>Avg apps per category</span>
                </div>
                <div className="stat">
                  <strong>{stats.avgRating ? stats.avgRating.toFixed(1) : '—'}</strong>
                  <span>Overall rating</span>
                </div>
              </div>
            </div>
          </div>

          {persona === 'admin' && (
            <div className="panel">
              <h2>Admin • Add application</h2>
              <form className="grid" style={{ gap: 10 }} onSubmit={onAddApp}>
                <div>
                  <label>Name</label>
                  <input value={newApp.name} onChange={handleChange('name')} placeholder="e.g., Compliance Toolkit" required />
                </div>
                <div>
                  <label>Category</label>
                  <select value={newApp.category} onChange={handleChange('category')}>
                    <option>Monitoring</option>
                    <option>Productivity</option>
                    <option>DevOps</option>
                    <option>Security</option>
                    <option>Data</option>
                  </select>
                </div>
                <div>
                  <label>Description</label>
                  <textarea value={newApp.description} onChange={handleChange('description')} placeholder="What problem does it solve?" required />
                </div>
                <div>
                  <label>Usage fields (comma separated)</label>
                  <input value={newApp.usageFields} onChange={handleChange('usageFields')} placeholder="Compliance, Finance" />
                </div>
                <div>
                  <label>Feature highlights (comma separated)</label>
                  <input value={newApp.features} onChange={handleChange('features')} placeholder="Audit log, RBAC" />
                </div>
                <div>
                  <label>Download URL</label>
                  <input value={newApp.downloadUrl} onChange={handleChange('downloadUrl')} placeholder="https://..." />
                </div>
                <div style={{ display: 'flex', justifyContent: 'flex-end' }}>
                  <button className="button primary" type="submit">
                    Add application
                  </button>
                </div>
              </form>
              <div className="alert info" style={{ marginTop: 12 }}>
                Tip: Categories and usage fields help new joiners find the right app without searching shared drives.
              </div>
            </div>
          )}
        </div>
      );
    };

    const Catalog = ({ persona, apps, allApps, selectedAppId, onSelectApp, onDownload, onFeedback, feedback }) => {
      const chartRef = useRef(null);
      const ratingChartRef = useRef(null);

      useEffect(() => {
        const ctx = chartRef.current.getContext('2d');
        const ratingCtx = ratingChartRef.current.getContext('2d');

        const downloadChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: allApps.map((a) => a.name),
            datasets: [
              {
                label: 'Downloads',
                data: allApps.map((a) => a.downloadCount),
                backgroundColor: 'rgba(56, 189, 248, 0.6)',
                borderColor: 'rgba(56, 189, 248, 1)',
                borderWidth: 1,
              },
            ],
          },
          options: { plugins: { legend: { labels: { color: '#e5e7eb' } } }, scales: { x: { ticks: { color: '#9ca3af' } }, y: { ticks: { color: '#9ca3af' } } } },
        });

        const ratingChart = new Chart(ratingCtx, {
          type: 'line',
          data: {
            labels: allApps.map((a) => a.name),
            datasets: [
              {
                label: 'Average rating',
                data: allApps.map((a) => average(a.ratings)),
                borderColor: 'rgba(167, 139, 250, 1)',
                backgroundColor: 'rgba(167, 139, 250, 0.2)',
                tension: 0.3,
              },
            ],
          },
          options: { plugins: { legend: { labels: { color: '#e5e7eb' } } }, scales: { x: { ticks: { color: '#9ca3af' } }, y: { ticks: { color: '#9ca3af' }, suggestedMin: 0, suggestedMax: 5 } } },
        });

        return () => {
          downloadChart.destroy();
          ratingChart.destroy();
        };
      }, [allApps]);

      return (
        <div className="grid" style={{ gap: 14 }}>
          <div className="panel">
            <h2>Catalog</h2>
            <div className="grid" style={{ gap: 12 }}>
              {apps.length === 0 && <div className="alert warn">No applications found. Try clearing filters.</div>}
              {apps.map((app) => (
                <div key={app.id} className="app-card">
                  <div>
                    <div className="card-meta">
                      <span className="pill">{app.category}</span>
                      <span>Updated {app.lastUpdated}</span>
                      <span>v{app.version}</span>
                    </div>
                    <h3 style={{ margin: '4px 0' }}>{app.name}</h3>
                    <p style={{ margin: '6px 0', color: '#d1d5db', lineHeight: 1.5 }}>{app.description}</p>
                    <div className="tag-row">
                      {app.usageFields.map((field) => (
                        <span key={field} className="usage-tag">{field}</span>
                      ))}
                    </div>
                    <div style={{ color: '#a5b4fc', fontSize: 13, margin: '6px 0' }}>
                      Features: {app.features.join(' • ')}
                    </div>
                    <div className="stats">
                      <div className="stat">
                        <strong>{app.downloadCount}</strong>
                        <span>Downloads</span>
                      </div>
                      <div className="stat">
                        <strong>{average(app.ratings).toFixed(1) || '—'}</strong>
                        <span>Avg rating</span>
                      </div>
                    </div>
                    <div style={{ marginTop: 10 }}>
                      <button className="button primary" onClick={() => onDownload(app.id)}>
                        Download
                      </button>
                      <button className="button ghost" style={{ marginLeft: 8 }} onClick={() => onSelectApp(app.id)}>
                        View feedback
                      </button>
                    </div>
                  </div>
                  <div style={{ display: 'grid', gap: 10, justifyItems: 'end' }}>
                    <div className="badge">{app.category}</div>
                    <div style={{ textAlign: 'right', color: var(--muted) }}>
                      <div style={{ fontSize: 12 }}>Release</div>
                      <div style={{ fontWeight: 700 }}>{app.lastUpdated}</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {selectedAppId && (
            <div className="panel">
              <Detail
                app={allApps.find((a) => a.id === selectedAppId)}
                persona={persona}
                feedback={feedback}
                onFeedback={onFeedback}
              />
            </div>
          )}

          <div className="panel">
            <h2>Insights</h2>
            <div className="chart-grid">
              <canvas ref={chartRef} height="180"></canvas>
              <canvas ref={ratingChartRef} height="180"></canvas>
            </div>
          </div>
        </div>
      );
    };

    const Detail = ({ app, persona, feedback, onFeedback }) => {
      if (!app) return null;

      return (
        <div className="grid" style={{ gap: 12 }}>
          <div>
            <div className="card-meta" style={{ marginBottom: 4 }}>
              <span className="pill">{app.category}</span>
              <span>Last updated {app.lastUpdated}</span>
              <span>v{app.version}</span>
              <span>{app.downloadCount} downloads</span>
            </div>
            <h2 style={{ margin: '6px 0 6px' }}>{app.name}</h2>
            <p style={{ color: '#d1d5db', lineHeight: 1.5 }}>{app.description}</p>
            <div className="tag-row">
              {app.usageFields.map((field) => (
                <span key={field} className="usage-tag">{field}</span>
              ))}
            </div>
            <div style={{ color: '#a5b4fc', fontSize: 13 }}>Features: {app.features.join(' • ')}</div>
          </div>

          <div className="divider" />

          <div>
            <h3>User feedback</h3>
            <div className="grid" style={{ gap: 8 }}>
              {app.suggestions.length === 0 && <div className="alert info">No feedback yet. Be the first to leave a note.</div>}
              {app.suggestions.map((s, idx) => (
                <div key={idx} className="alert" style={{ background: 'rgba(79, 70, 229, 0.08)', border: '1px solid rgba(79, 70, 229, 0.3)' }}>
                  <strong style={{ textTransform: 'capitalize' }}>{s.role}</strong>: {s.message}
                </div>
              ))}
            </div>
          </div>

          <div className="divider" />

          <div>
            <h3>{persona === 'admin' ? 'Log update or response' : 'Leave a rating & suggestion'}</h3>
            <form className="grid" style={{ gap: 10 }} onSubmit={(e) => onFeedback(e, app.id)}>
              <div>
                <label>Rating</label>
                <select value={feedback.rating} onChange={(e) => feedback.setRating(Number(e.target.value))}>
                  {[1, 2, 3, 4, 5].map((n) => (
                    <option key={n} value={n}>
                      {n} star{n > 1 ? 's' : ''}
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label>{persona === 'admin' ? 'Update or mitigation note' : 'Suggestion'}</label>
                <textarea
                  value={feedback.comment}
                  onChange={(e) => feedback.setComment(e.target.value)}
                  placeholder="Share deployment status, rollout notes, or UX suggestions"
                />
              </div>
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: 8 }}>
                <button className="button ghost" type="button" onClick={feedback.reset}>Clear</button>
                <button className="button primary" type="submit">
                  Submit
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
